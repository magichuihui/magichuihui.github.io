## 网站遭遇ddos攻击处理总结

### 前言

8月6号10点左右，接到电话公司网站遭到攻击导致服务器重启，马上登陆服务器查看是否有可疑进程，以及网络连接情况。没有发现异常的进程，主机状态正常，只是有很多redis, MySQL的连接处于`TIME_WAIT`状态。用tcpdump监听80端口内容有`GET`, `HTTP`的数据包发现短时间内大量不同IP访问，远远超过正常的访问量。初步得出结论可能是遭遇了ddos攻击。

awk统计nginx日志，其中一个IP地址访问量119万次！！而且这些IP都是来自江苏徐州电信，使用iptables 禁止他们访问。这些攻击的请求只有以下2种：

>117.87.75.118 - - [06/Aug/2017:23:59:59 +0800] "POST /background/login/login HTTP/1.1"

>119.29.125.187 - - [06/Aug/2017:00:00:00 +0800] "HEAD / HTTP/1.1" 200 0 "-" "-"

### 总结

为了以后能更好的应对此类攻击，总结几个方案；

#### 增加主机性能，并非单纯加一台主机或者提升主机的配置。目前网站的架构是一个项目一套nginx集群 + php，把多个项目的nginx组成一个大的集群应该会提高web负载能力。

#### nginx替换成tengine + ngx_lua_waf，Tengine是由淘宝网发起的Web服务器项目。它在Nginx的基础上，针对大访问量网站的需求，添加了很多高级功能和特性，并且支持Lua。配置ngx_lua_waf的denycc防CC攻击。
